# ХОРОШИЙ docker-compose.yml

version: "3.9"

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - FLASK_ENV=production
      # Логически как будто ходим в БД, но сетевой связи реально нет
      - DB_HOST=db
      - DB_USER=app
      - DB_PASSWORD=app-password
    # Пробрасываем только порт приложения
    ports:
      - "8080:8000"
    # web в своей сети
    networks:
      - web_net
    restart: on-failure

  db:
    # Фиксируем версию, без latest
    image: mysql:8.0
    environment:
      - MYSQL_DATABASE=app
      - MYSQL_USER=app
      - MYSQL_PASSWORD=app-password
      - MYSQL_ROOT_PASSWORD=change-me
    # Нормальный именованный volume для данных БД
    volumes:
      - db_data:/var/lib/mysql
    # db в другой сети
    networks:
      - db_net
    restart: on-failure

volumes:
  db_data:

networks:
  web_net:
    driver: bridge
  db_net:
    driver: bridge
