# CI/CD Lab: Bad vs Good (GitHub Actions)

## Цель
1) Написать "плохой" CI/CD workflow, который работает, но содержит минимум 3 bad practices  
2) Написать "хороший" workflow, где эти bad practices исправлены  
3) Описать в README: что плохо, почему плохо, как исправлено, и как это повлияло на результат  
4) Прочитать историю про Васю и сформулировать выводы для CI/CD/DevOps

---

## Файлы
- `.github/workflows/bad-ci.yml` — плохой вариант (работает, но небезопасен/некачественен)
- `.github/workflows/good-ci.yml` — хороший вариант (best practices)
- `REPORT.md` — отчёт для сдачи

---

## Bad practices и исправления

| № | Bad practice в `bad-ci.yml` | Почему это плохо | Исправление в `good-ci.yml` | Как повлияло на результат |
|---|---|---|---|---|
| 1 | `uses: actions/checkout@master` (плавающая ссылка) | Непредсказуемость сборок + supply-chain риск: поведение может измениться без изменения вашего репо | Используется стабильный мажор `actions/checkout@v6` | Сборка становится повторяемой и предсказуемой (меняется только при обновлении мажора) |
| 2 | `permissions: write-all` | Принцип наименьших привилегий нарушен: при компрометации job злоумышленник получит максимум прав | В корне `permissions: contents: read`, а на deploy — только нужные права | Уменьшение blast radius: даже при проблеме в job ущерб ограничен |
| 3 | `env | sort` + `set -x` (агрессивный debug) | В логах легко “вынести” чувствительный контекст/секреты (или их части), плюс засорение логов | Убраны шумные debug-команды; при необходимости — точечная диагностика | Логи чище, меньше риск утечек |
| 4 | Установка через `apt-get` каждый раз, без кэша | Медленно и нестабильно (зависимость от зеркал/сети), лишняя вариативность окружения | `actions/setup-python@v6` + `cache: pip` | Быстрее и стабильнее: зависимости кэшируются, меньше сетевых операций |
| 5 | Тесты не “гейтят” пайплайн (`continue-on-error: true`, `pytest || true`) | Можно “успешно задеплоить” сломанный код | Тесты обязательны: при падении job завершается ошибкой | Качество выше: деплой невозможен при красных тестах |
| 6 | Deploy запускается на любом событии (включая PR) | Риск несанкционированного/случайного деплоя | Deploy только на `push` в `main` + `environment: production` | Деплой контролируемый: только из main, можно включить approval в настройках environment |

---

## Как запустить и проверить
1) Закоммитьте файлы в репозиторий
2) Откройте вкладку **Actions**
3) Запустите вручную `BAD CI/CD (works, but unsafe)` (workflow_dispatch) и сделайте скриншот
4) Сделайте push в `main` (или PR в main) и проверьте `CI/CD (good practices)`:
   - на PR должен выполняться только `test`
   - на push в `main` — `test` и затем `deploy`
5) Приложите скриншоты в `REPORT.md`